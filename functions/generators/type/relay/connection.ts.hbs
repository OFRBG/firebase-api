// @format
import {connectionFromArray, connectionDefinitions, connectionArgs} from 'graphql-relay';
import {merge, get, has, set} from 'lodash';

import {model} from '../type';
import {args} from '../fields';
import {get {{~ properCase name ~}} } from '../resolvers/resolvers';

const {connectionType} = connectionDefinitions({nodeType: model});

export const connection = (path = '{{ collectionName }}') => ({
  type: connectionType,
  description: '{{ properCase name }} connection',
  args: merge({}, args, connectionArgs),
  resolve: async (item, args) => {
    const requestArgs = has(item, path)
      ? set(args, 'ids', get(item, path))
      : args;

    const nodes = await get{{ properCase name }}(null, requestArgs);

    return connectionFromArray(nodes, args);
  }
});

export const rootConnection = connection();
